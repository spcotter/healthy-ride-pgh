(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(t,e,a){t.exports=a(155)},115:function(t,e,a){},149:function(t,e,a){},155:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),o=a(102),l=a.n(o),i=(a(115),a(58)),c=a(22),s=a(18),u=a(25),m=a(23),f=a(26),d=a(166),h=a(168),p=a(169),g=a(3),b=a(160),v=a(157),E=a(158),y=a(159),C=g.d("0.1%"),w=g.d(",.0f"),k=g.d(",.1f"),O=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).legendBox=function(t,e){return r.a.createElement("div",{style:{position:"relative",textAlign:"right"}},r.a.createElement("div",{className:"clearfix",style:{marginBottom:5,fontSize:10,lineHeight:"10px",position:"relative"}},r.a.createElement("div",{className:"pull-right",style:{width:10,height:10,backgroundColor:t}}),r.a.createElement("div",{style:{marginRight:15,color:"#777"}},e)))},a.state={},a}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this.props,e=t.overallTotal,a=t.children;return r.a.createElement("div",null,r.a.createElement(v.a,{fluid:!0},r.a.createElement(E.a,null,r.a.createElement(y.a,{sm:6},r.a.createElement(b.a,{to:"/"},r.a.createElement("h2",{style:{marginBottom:0}},"Healthy Ride"))),r.a.createElement(y.a,{sm:6,style:{textAlign:"right"}},r.a.createElement("h2",{style:{marginTop:15,marginBottom:5}},r.a.createElement("small",null,w(e)," rides")))),r.a.createElement(E.a,null,r.a.createElement(y.a,{sm:6},r.a.createElement("small",null,"May 31, 2015 - June 30, 2018")),r.a.createElement(y.a,{sm:6},r.a.createElement("div",{className:"pull-right"},r.a.createElement("div",null,this.legendBox("#3C8AF1","Returned to same station")),r.a.createElement("div",null,this.legendBox("#9EC6FB","Returned to another station")))))),r.a.createElement("div",{style:{position:"absolute",top:90,bottom:0,right:0,left:0,borderTop:"1px solid whitesmoke"}},a))}}]),e}(r.a.Component),j=function(t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:x.left},t.left),r.a.createElement("div",{style:x.right},t.right))},x={left:{top:0,right:"40%",bottom:0,left:0,position:"absolute"},right:{top:0,right:0,bottom:0,left:"60%",position:"absolute",overflowY:"scroll"}},S=a(161),B=(a(149),function(t){var e=t.height||10,a=t.fills||[],n=t.widths||[],o=t.outerWidth||n.reduce(function(t,e){return t+e},0),l=0;return r.a.createElement("div",{className:"SplitDataBar"},r.a.createElement("svg",{width:C(o),height:e},n.map(function(t,n){var o=l;return l+=t,r.a.createElement("rect",{x:C(o),y:0,height:e,width:C(t),fill:a[n],key:n})})))}),T=g.d(",.0f"),N=g.d(".1%"),D=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(m.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this.props,e=t.loading,a=t.stations,n=t.stationTotals,o=t.overallTotal,l=t.fromToData,i=t.clusters,c=t.clustersK;if(e)return r.a.createElement("div",null);var s=n[a[0].number];return r.a.createElement("div",null,a.map(function(t){var e=n[t.number],a=l.find(function(e){return e.from===t.number&&e.to===t.number}).freq,u=e/s,m=[a/e,(e-a)/e];return r.a.createElement("div",{style:q.listItem,key:t.number},c?r.a.createElement("div",{className:"pull-right"},r.a.createElement("div",{style:{width:10,height:10,borderRadius:10,backgroundColor:g.g[i[t.number][c]]}})):null,r.a.createElement("div",{style:q.nameWrapper},r.a.createElement(b.a,{to:"/".concat(t.number)},r.a.createElement("div",{style:q.name},t.name))),r.a.createElement("div",{style:q.barWrapper},r.a.createElement(S.a,{className:"pull-right",style:q.category},t.category),r.a.createElement("div",{style:q.number},T(e)," rides, ",N(e/o)," of total"),r.a.createElement("div",null,r.a.createElement(B,{outerWidth:u,widths:m,fills:["#398BFB","#9cc5fd"]}))))}))}}]),e}(r.a.PureComponent),q={listItem:{padding:10,marginBottom:5,paddingBottom:20,borderBottom:"1px solid whitesmoke"},nameWrapper:{height:20,position:"relative"},name:{width:"calc(100% - 40px)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",color:"#555"},category:{color:"#337ab7",backgroundColor:"whitesmoke"},barWrapper:{height:20,position:"relative"},number:{fontSize:12,color:"black"}},M=D,K=a(12),z=a.n(K),R=a(164),W=a(167),_=a(162),A=a(163),L=a(39),F=Object(L.a)({}),I=function(t){function e(){var t,a;Object(c.a)(this,e);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).onClick=function(t){F.push("/".concat(t))},a}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this,e=this.props,a=e.fromToData,n=e.stationTotals,o=e.stations,l=e.locations,i=e.loading,c=e.clusters,s=e.clustersK,u=e.onChangeClustersK;if(i)return r.a.createElement("div",null);var m=new z.a.LatLngBounds(o.map(function(t){return[t.latitude,t.longitude]})),f=a.filter(function(t){return l[t.from]&&l[t.to]}).map(function(t){return{from:t.from,to:t.to,line:[l[t.from],l[t.to]],percent:t.freq/n[t.from]}}),d=g.c(f,function(t){return t.percent}),h=g.f(.5).domain(d).range([.01,1]),p=g.e().domain(d).range([.01,3]),b=n[o[0].number],v=g.f(.5).domain([0,b]).range([2,12]),E=f.filter(function(t){return t.to!==t.from}),y=f.filter(function(t){return t.to===t.from});return r.a.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,left:0}},r.a.createElement(R.a,{bounds:m,style:{position:"absolute",top:0,right:0,bottom:0,left:0},zoomControl:!1},r.a.createElement(W.a,{attribution:"\xa9 <a href='http/://cartodb.com/attributions'>CartoDB</a>",url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png",maxZoom:19,subdomains:"abcd",opacity:.35}),r.a.createElement(W.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> \u2014 Map data \xa9 <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toposm-color-relief/{z}/{x}/{y}.jpg",maxZoom:19,maxNativeZoom:12,subdomains:"abcd",opacity:.35}),E.map(function(t,e){return r.a.createElement(_.a,{positions:t.line,key:"Polyline-".concat(e),weight:p(t.percent),opacity:h(t.percent)})}),y.map(function(t,e){return r.a.createElement(A.a,{center:t.line[0],key:"Circle-".concat(e),fillOpacity:0,radius:v(n[t.from]),weight:p(t.percent),opacity:h(t.percent)})}),o.map(function(e){return r.a.createElement(A.a,{key:"CircleMarker-".concat(e.number),center:[e.latitude,e.longitude],radius:v(n[e.number]),width:5,color:"transparent",fillOpacity:0,fillColor:"#ffffff",onClick:function(){return t.onClick(e.number)}})}),o.map(function(e,a){return r.a.createElement(A.a,{key:"CircleCenter-".concat(e.number),center:[e.latitude,e.longitude],radius:v(n[e.number]),width:5,opacity:0,color:"transparent",fillOpacity:s?.7:.25,fillColor:s?g.g[c[e.number][s]]:"#0462e2",onClick:function(){return t.onClick(e.number)}})})),r.a.createElement("div",{style:{position:"absolute",top:15,right:15,width:100,zIndex:1e3}},r.a.createElement("select",{className:"form-control input-sm",value:s,onChange:u},r.a.createElement("option",{value:""},"None"),r.a.createElement("option",{value:"c2"},"2 Clusters"),r.a.createElement("option",{value:"c3"},"3 Clusters"),r.a.createElement("option",{value:"c4"},"4 Clusters"),r.a.createElement("option",{value:"c5"},"5 Clusters"),r.a.createElement("option",{value:"c6"},"6 Clusters"))))}}]),e}(r.a.Component),P=function(t){return t.loading?r.a.createElement("div",{style:{padding:50,textAlign:"center"}},r.a.createElement("i",{className:"fas fa-bicycle fa-spin fa-3x"})):r.a.createElement(j,{left:r.a.createElement(I,t),right:r.a.createElement(M,t)})},H=a(165),J=function(t){return t*(Math.PI/180)},Y=function(t){var e=t.clusters,a=t.clustersK,n=t.stationNumber;return a?r.a.createElement("div",{className:"pull-right"},r.a.createElement("div",{style:{width:10,height:10,borderRadius:10,backgroundColor:g.g[e[n][a]]}})):null},Z=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(m.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this.props,e=t.stations,a=t.stationTotals,n=t.overallTotal,o=t.fromToData,l=t.stationNumber,i=t.clusters,c=t.clustersK,s={};e.forEach(function(t){return s[t.number]=t});var u=s[l],m=a[u.number];return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("div",{style:{backgroundColor:"whitesmoke",padding:15}},r.a.createElement("h4",null,r.a.createElement(S.a,{className:"pull-right",bsStyle:"primary",bsSize:"medium"},u.category),u.name),r.a.createElement("h5",null,w(m)," or ",C(m/n)," of all rides")),r.a.createElement("div",{style:$.popularHeading},"Popular destinations from this station:")),r.a.createElement("div",{style:{position:"absolute",overflowY:"scroll",top:122,right:0,bottom:0,left:0}},o.map(function(t,e){var n=s[t.to];if(!n)return null;var o=t.freq/a[u.number],l=function(t,e,a,n){var r=J(a-t),o=J(n-e),l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(J(t))*Math.cos(J(a))*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}(u.latitude,u.longitude,n.latitude,u.longitude);return r.a.createElement("div",{key:e,style:$.destination},r.a.createElement(Y,{clusters:i,clustersK:c,stationNumber:t.to}),r.a.createElement("div",{style:$.destinationName},s[t.to].name),r.a.createElement("div",{style:$.p}," ",C(o),", ",k(.62137*l)," mi, ",w(t.duration)," m"),r.a.createElement(B,{outerWidth:o,widths:[1],fills:t.to===u.number?["#398BFB"]:["#9cc5fd"]}))})))}}]),e}(r.a.Component),$={popularHeading:{paddingLeft:10,paddingTop:5,paddingRight:10,paddingBottom:5,fontSize:12,borderBottom:"1px solid whitesmoke",backgroundColor:"rgb(235,235,235)"},destination:{paddingTop:5,paddingBottom:5,paddingLeft:10,paddingRight:10,borderBottom:"1px solid whitesmoke"},destinationName:{fontSize:14,color:"#555"},p:{fontSize:12}},G=function(t){if(t.loading)return r.a.createElement(H.a,{to:"/"});var e=t.match.params.stationNumber,a=t.fromToData.filter(function(t){return t.from===e&&t.freq>0}).sort(function(t,e){return g.b(t.freq,e.freq)}),n=a.map(function(t){return t.to}).concat([e]);console.log("includedStations",n);var o=Object(i.a)({},t,{fromToData:a,stations:t.stations.filter(function(t){return n.indexOf(t.number)>-1})});return o.stationNumber=e,console.log("filteredProps",o),r.a.createElement(j,{left:r.a.createElement(I,o),right:r.a.createElement(Z,o)})},Q=function(t){function e(){var t,a;Object(c.a)(this,e);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(t=Object(m.a)(e)).call.apply(t,[this].concat(r)))).state={loading:!0,fromToData:null,stationTotals:null,stations:null,locations:null,clusters:null,overallTotal:null,clustersK:"c6"},a.componentDidMount=function(){a.loadRideData().then(a.loadStationData).then(a.loadClusterData).then(a.categorizeStations).finally(function(){return a.setState({loading:!1})})},a.loadRideData=function(){return g.a("./from_to_data.csv",function(t){return{from:t.from,to:t.to,freq:+t.freq,duration:+t.duration_s/60}}).then(function(t){var e=a.totals(t);a.setState({fromToData:t.filter(function(t){return t.freq>0}),stationTotals:e.byStation,overallTotal:e.overall})})},a.loadStationData=function(){return g.a("./healthyridestations2017.csv",function(t){return{number:t["Station #"],name:t["Station Name"],racks:+t["# of Racks"],latitude:+t.Latitude,longitude:+t.Longitude}}).then(function(t){var e=a.state.stationTotals;t=t.sort(function(t,a){return g.b(e[t.number],e[a.number])});var n={};t.forEach(function(t){n[t.number]=[t.latitude,t.longitude]}),a.setState({stations:t,locations:n})})},a.loadClusterData=function(){return g.a("./clusters.csv").then(function(t){var e={};t.forEach(function(t){return e[t.station_number]=t}),console.log("clusters",e),a.setState({clusters:e})})},a.totals=function(t){var e=0,a={};return t.forEach(function(t){var n=a[t.from]||0;n+=t.freq,e+=t.freq,a[t.from]=n}),{byStation:a,overall:e}},a.categorizeStations=function(){var t=a.state,e=t.stations,n=t.fromToData,r=t.stationTotals;e.forEach(function(t){var e=n.filter(function(e){return e.from===t.number}).sort(function(t,e){return g.b(t.freq,e.freq)});t.category=e[0].to===t.number?"Out-and-back":"Commuter",t.majority_return="Out-and-back"===t.category&&e[0].freq>=.5*r[t.number],console.log(t.number,t.category,t.majority_return,e[0].freq,r[t.number])}),console.log("stations",e)},a.onChangeClustersK=function(t){a.setState({clustersK:t.target.value})},a}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this;return r.a.createElement(d.a,{history:F,basename:"/healthy-ride-pgh"},r.a.createElement(h.a,null,r.a.createElement(p.a,{exact:!0,path:"/",component:function(e){var a=Object(i.a)({},t.state,e,{onChangeClustersK:t.onChangeClustersK});return r.a.createElement(O,t.state,r.a.createElement(P,a))}}),r.a.createElement(p.a,{exact:!0,path:"/:stationNumber",component:function(e){var a=Object(i.a)({},t.state,e,{onChangeClustersK:t.onChangeClustersK});return r.a.createElement(O,t.state,r.a.createElement(G,a))}})))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[110,2,1]]]);
//# sourceMappingURL=main.ec090864.chunk.js.map